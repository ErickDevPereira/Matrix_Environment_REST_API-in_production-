<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body style = 'font-family: sans-serif; padding: 30px;'>
    <h1>Matrx Environment REST API</h1>
    <hr>
    <h2>Overview</h2>
    <hr>
    <p>This project is a RESTful API built in Python using Flask that aggregates and processes data from two external sources: WeatherAPI and Safecast API. The API consumes raw data from these services and transforms it using SQL, Pandas, and NumPy, returning clean, organized, and aggregated results to the client in a concise JSON format.</p>
    <p>The primary goal of this project is to abstract complex and verbose third-party API responses into expressive and lightweight JSON outputs, optimized for client consumption.</p>
    <p>For real-time data requests, the API retrieves information from both WeatherAPI (weather conditions) and Safecast API (ionizing radiation levels). The retrieved datasets are combined and processed using SQL queries alongside Pandas and NumPy operations, producing a unified and well-structured JSON response.</p>
    <p>In addition to data retrieval, the API provides a comment system that allows users to submit observations related to weather or ionizing radiation at a specific geographic location. Users can create comments using a POST request and receive a unique token that authorizes them to later update (PATCH) or delete (DELETE) their comment. Comments associated with a given location can be retrieved using a GET request.</p>
    <p>Most of the requests are parameterized by latitude and longitude, which define the geographic point used for data aggregation and comment association.</p>
    <br>
    <h2>Key features</h2>
    <hr>
    <ul>
        <li>User interaction with location-based comments via POST, PATCH, DELETE, and GET requests.</li>
        <li>Data analysis and aggregation over real, unstructured data retrieved from multiple external APIs.</li>
        <li>Access to three-day weather forecasts for a specific geographic point, returned as a concise and well-structured JSON</li>
        <li>Access to real-time weather and ionizing radiation data for a given location.</li>
        <li>Optional detailed responses, allowing the client to choose between summarized or extended JSON output via a detail parameter.</li>
    </ul>
    <h2>Tech Stack</h2>
    <hr>
    <ul>
        <li><strong>Python:</strong> primary programming language used to implement the API</li>
        <li><strong>flask_restful:</strong> Flask extension used to design and structure RESTful endpoints</li>
        <li><strong>Numpy:</strong> library used for numerical computation and mathematical operations</li>
        <li><strong>Pandas:</strong> library used for data manipulation and processing through DataFrame abstractions</li>
        <li><strong>MySQL:</strong> relational database management system used for SQL processing and storage of tokens, comments, and temporary weather data</li>
    </ul>
    <h2>Technical notes</h2>
    <hr>
    <ul>
        <li>Request-scoped token processing</li>
        <li>No ORM was used, providing full control over database behavior, query optimization, and overall performance through explicit SQL.</li>
        <li>A mathematical model was designed to estimate ionizing radiation levels at a given geographic point. The model defines a circular region centered at the target coordinates (latitude, longitude) and computes a weighted average of radiation measurements collected from surrounding points obtained via the Safecast API. The weights are inversely proportional to the distance from each measurement point to the center, ensuring that closer points contribute more strongly to the final estimation. This approach produces a fair and reliable result for ionizing radiation, a domain where measurements are sparse and difficult to obtain.</li>
        <li>The project architecture is fully object-oriented. Each module encapsulates a well-defined responsibility within the system, with consistent use of abstraction, polymorphism, encapsulation, multiple inheritance, and abstract base classes to enforce clear contracts and maintain extensibility.</li>
    </ul>
    <p>Explanation of <strong>Request-scoped token processing</strong>:</p>
    <p>A token-based system was implemented to safely handle concurrent requests and temporary data processing.</p>
    <p>Whenever a user requests forecast data, a unique random token is generated for that request and persisted in a dedicated token table, which enforces uniqueness at the database level.</p>
    <p>All forecast records generated by that request are then inserted into the forecast table and tagged with this token. The primary key of each record is composed of the request token concatenated with an incremental identifier, ensuring strict request-level isolation.</p>
    <p>Data aggregation and processing are performed directly in SQL, filtered by the request token. Once the aggregated results are retrieved by the API and returned to the user as a JSON response, all temporary records associated with that token are deleted from the database. The token itself is also removed afterward.</p>
    <p>This approach treats the database as an ephemeral processing workspace rather than permanent storage, preventing unnecessary data persistence. By isolating each request through a unique token, the system safely supports multiple concurrent and parallel requests without race conditions or data interference.</p>
    <br>
    <p>mathematical model used to get the most correct radiation value for a given point.</p>
    <br>
    <img src = "imgs/calculus.png">
    <br>
    <br>
    request-response cicle used by this API
    <br>
    <img src = "imgs/API.png">
    <h2>How to use</h2>
    <hr>
    You can run a server for this application by following the steps:
    <ol>
        <li>Install MySQL and create a user with a password.</li>
        <li>Create and activate a Python virtual environment.</li>
        <li>From the project root directory, run: <code>pip install -r requirements.txt</code></li>
        <li>Go to <a href = 'https://api.safecast.org/' target = '_blank'>https://api.safecast.org/</a> and create a token for safecastAPI and go to <a href = "https://www.weatherapi.com/" target = "_blank">https://www.weatherapi.com/</a> in order to create a token to access the weatherapi.</li>
        <li>Run the main.py script and provide your MySQL credentials and API tokens when prompted</li>
        <li>Now the server is on and ready to be used</li>
    </ol>
    /test has examples teaching how to use each feature of the API.
    <h2>Screenshots:</h2>
    <hr>
    <p>JSON for endpoint GET /forecast_environment?latitude=23.4558&longitude=45.6396</p>
    <img src = "imgs/forecast.png">
    <p>JSON for endpoint GET /actual_environment?latitude=52.5200&longitude=13.4050&detail=True</p>
    <img src = "imgs/actual_env.png">
    <p>JSON for endpoint GET /my_opinion?latitude=23.4558&longitude=45.6396</p>
    <img src = "imgs/get_comments.png">
</body>
</html>
